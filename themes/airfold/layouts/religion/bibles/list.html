{{ define "main" }}
<div class="max-w-4xl mx-auto px-4 py-12">
  <header class="text-center mb-8">
    <h1 class="text-3xl md:text-4xl font-hand font-bold text-paper-black mb-2">
      {{ i18n "bibles" | default "Bibles" }}
    </h1>
    <p class="text-lg font-hand text-paper-gray">
      {{ i18n "biblesDescription" | default "Browse available Bible translations" }}
    </p>
    <!-- Quick actions -->
    <div class="flex flex-wrap justify-center gap-4 mt-4">
      <a href="/religion/bibles/search/" class="btn-paper">
        {{ i18n "searchBible" | default "Search Bible" }}
      </a>
      <a href="/religion/bibles/compare/" class="btn-paper">
        {{ i18n "compareTranslations" | default "Compare Translations" }}
      </a>
    </div>

    <!-- Filter by tag -->
    {{/* Build unique tags from all bibles */}}
    {{ $allTags := slice }}
    {{ range .Site.Data.bibles.bibles }}
      {{ range .tags }}
        {{ $allTags = $allTags | append . }}
      {{ end }}
    {{ end }}
    {{ $uniqueTags := $allTags | uniq | sort }}

    <div class="flex flex-wrap justify-center gap-2 mt-6" id="bible-filters" role="group" aria-label="{{ i18n "filterByTag" | default "Filter by Tag" }}">
      <button
        type="button"
        data-tag="all"
        aria-pressed="true"
        class="bible-filter active text-sm px-3 py-1 border border-accent rounded bg-accent text-white transition-colors font-hand focus:outline-2 focus:outline-accent focus:outline-offset-2">
        {{ i18n "all" | default "All" }}
      </button>
      {{ range $uniqueTags }}
      <button
        type="button"
        data-tag="{{ . | urlize }}"
        aria-pressed="false"
        class="bible-filter text-sm px-3 py-1 border border-paper-black rounded hover:bg-accent hover:border-accent hover:text-white transition-colors font-hand focus:outline-2 focus:outline-accent focus:outline-offset-2">
        {{ . }}
      </button>
      {{ end }}
    </div>
  </header>

  <!-- Quick navigation -->
  <nav class="bible-nav mb-6 p-4" aria-label="{{ i18n "bibleNavigation" | default "Bible Navigation" }}">
    <div class="flex flex-wrap items-center justify-center gap-3">
      <!-- Bible selector -->
      <div class="relative">
        <label class="sr-only" for="bible-select">{{ i18n "selectBible" | default "Select Bible" }}</label>
        <select id="bible-select"
                class="bible-nav-select appearance-none border border-paper-gray rounded px-3 py-1.5 pr-8 font-hand text-sm cursor-pointer hover:border-accent focus:border-accent focus:outline-none bg-white dark:bg-paper-dark"
                onchange="if(this.value) window.location.href=this.value">
          <option value="" selected disabled>{{ i18n "selectBible" | default "Select Bible" }}</option>
          {{ range .Site.Data.bibles.bibles }}
          <option value="/religion/bibles/{{ .id }}/">
            {{ .title }} ({{ .abbrev }})
          </option>
          {{ end }}
        </select>
        <span class="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-paper-gray">â–¾</span>
      </div>
    </div>
  </nav>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="bibles-grid">
    {{/* Only show pages with abbrev param (actual Bible translations, not books/chapters) */}}
    {{ range where .Pages ".Params.abbrev" "!=" nil }}
    <a href="{{ .RelPermalink }}" class="bible-card block p-6 card-paper hover:shadow-lg transition-shadow" data-tags="{{ delimit .Params.tags "," | urlize }}">
      <h2 class="text-xl font-hand font-bold text-paper-black mb-2">{{ .Title }}</h2>
      {{ with .Params.description }}
      <p class="text-paper-gray font-hand text-sm mb-3">{{ . }}</p>
      {{ end }}
      <div class="flex flex-wrap gap-2">
        {{ with .Params.language }}
        <span class="text-xs bg-paper-black text-paper-cream px-2 py-1 rounded">{{ . }}</span>
        {{ end }}
        {{/* License badge */}}
        {{ $pageAbbrev := .Params.abbrev | upper }}
        {{ range $.Site.Data.bibles.bibles }}
          {{ if eq (.abbrev | upper) $pageAbbrev }}
            {{ with .license }}
            <span class="text-xs bg-gradient-to-r from-paper-brown to-paper-gray text-paper-cream px-2 py-1 rounded license-badge cursor-pointer hover:from-accent hover:to-accent transition-all" title="License: {{ . }}" data-license="{{ . }}">{{ . }}</span>
            {{ end }}
          {{ end }}
        {{ end }}
        {{ range .Params.tags }}
        <span class="text-xs bg-accent/10 text-accent px-2 py-1 rounded">{{ . }}</span>
        {{ end }}
      </div>
    </a>
    {{ end }}
  </div>

  <p id="no-results" class="text-center text-paper-gray font-hand text-xl hidden mt-6">{{ i18n "noBiblesMatch" | default "No Bibles match this filter." }}</p>

  <!-- Back navigation -->
  <div class="text-center mt-8">
    <a href="/religion/" class="btn-paper">
      &larr; {{ i18n "backToReligion" | default "Back to Religion" }}
    </a>
  </div>
</div>

<script>
(function() {
  'use strict';

  function filterBibles(tag) {
    var cards = document.querySelectorAll('.bible-card');
    var buttons = document.querySelectorAll('.bible-filter');
    var noResults = document.getElementById('no-results');
    var visibleCount = 0;

    // Update button states and aria-pressed
    buttons.forEach(function(btn) {
      var isActive = btn.dataset.tag === tag;
      btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
      if (isActive) {
        btn.classList.add('bg-accent', 'text-white', 'active');
        btn.classList.remove('bg-paper-light', 'text-paper-gray', 'border-paper-black');
        btn.classList.add('border-accent');
      } else {
        btn.classList.remove('bg-accent', 'text-white', 'active', 'border-accent');
        btn.classList.add('border-paper-black');
      }
    });

    // Filter cards
    cards.forEach(function(card) {
      var cardTags = card.dataset.tags.toLowerCase();
      if (tag === 'all' || cardTags.includes(tag.toLowerCase())) {
        card.style.display = '';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });

    // Show/hide no results message
    if (visibleCount === 0) {
      noResults.classList.remove('hidden');
    } else {
      noResults.classList.add('hidden');
    }
  }

  // Event delegation for filter buttons
  var bibleFilters = document.getElementById('bible-filters');
  if (bibleFilters) {
    bibleFilters.addEventListener('click', function(e) {
      var button = e.target.closest('.bible-filter');
      if (button && button.dataset.tag) {
        filterBibles(button.dataset.tag);
      }
    });
  }

  // License badge clicks - navigate to license page
  var biblesGrid = document.getElementById('bibles-grid');
  if (biblesGrid) {
    biblesGrid.addEventListener('click', function(e) {
      var badge = e.target.closest('.license-badge');
      if (badge && badge.dataset.license) {
        e.preventDefault();
        e.stopPropagation();
        window.location.href = '/licenses/' + badge.dataset.license.toLowerCase() + '/';
      }
    });
  }
})();
</script>
{{ end }}
