{{ define "scripts" }}
{{ $search := resources.Get "js/bible-search.js" }}
{{ if $search }}
<script src="{{ $search.RelPermalink }}" defer></script>
{{ end }}
{{ end }}

{{ define "main" }}
{{ $basePath := .Site.Params.michael.basePath | default "/religion/bibles" }}
<main class="container">
  <header class="michael-header">
    <h1 class="font-hand">
      {{ .Title }}
    </h1>
    <p class="font-hand">
      {{ .Description }}
    </p>
  </header>

  <!-- Search Form -->
  <article>
    <form id="search-form">
      <div class="grid">
        <label>
          <span class="font-hand">{{ i18n "searchQuery" | default "Search for" }}:</span>
          <input
            type="text"
            id="search-query"
            name="q"
            placeholder="{{ i18n "searchPlaceholder" | default "word, \"exact phrase\", or H1234/G5678" }}"
            autocomplete="off"
          >
        </label>
        <label>
          <span class="font-hand">{{ i18n "selectBible" | default "Translation" }}:</span>
          <select id="bible-select" name="bible">
            {{ range .Site.Data.bibles.bibles }}
            <option value="{{ .id }}">{{ .abbrev }} - {{ .title }}</option>
            {{ end }}
          </select>
        </label>
      </div>
      <div class="grid">
        <button type="submit" class="contrast">
          {{ i18n "search" | default "Search" }}
        </button>
        <label class="font-hand">
          <input type="checkbox" id="case-sensitive" role="switch">
          {{ i18n "caseSensitive" | default "Case sensitive" }}
        </label>
        <label class="font-hand">
          <input type="checkbox" id="whole-word" role="switch">
          {{ i18n "wholeWord" | default "Whole word" }}
        </label>
      </div>
    </form>
  </article>

  <!-- Search Status -->
  <section id="search-status" class="font-hand hidden" style="text-align: center; color: var(--michael-gray);">
    {{ i18n "searching" | default "Searching..." }}
  </section>

  <!-- Search Results -->
  <section id="search-results">
    <div class="font-hand" style="text-align: center; color: var(--michael-gray); padding-block: 3rem;">
      <p>{{ i18n "searchPrompt" | default "Enter a search term to find verses across the Bible." }}</p>
      <p><small>{{ i18n "searchTypesHint" | default "Try: word, \"exact phrase\", or Strong's numbers (H430, G2316)" }}</small></p>
    </div>
  </section>

  <!-- Back Navigation -->
  <nav class="actions">
    <a href="{{ $basePath }}/" role="button" class="outline">
      &larr; {{ i18n "allBibles" | default "All Bibles" }}
    </a>
  </nav>
</main>

<!-- Bible Index Data for JavaScript - generated at build time -->
{{- $bibleIndex := dict -}}
{{- range $bible := .Site.Data.bibles.bibles -}}
  {{- $aux := index $.Site.Data.bibles_auxiliary $bible.id -}}
  {{- $books := slice -}}
  {{- with $aux -}}
    {{- range .books -}}
      {{- $books = $books | append (dict "id" .id "name" .name "chapters" (len .chapters)) -}}
    {{- end -}}
  {{- end -}}
  {{- $bibleIndex = $bibleIndex | merge (dict $bible.id (dict "title" $bible.title "abbrev" $bible.abbrev "books" $books)) -}}
{{- end -}}
<script id="bible-index" type="application/json">
{{ dict "bibles" $bibleIndex "basePath" $basePath | jsonify | safeJS }}
</script>
{{ end }}
