{{ define "scripts" }}
{{ $search := resources.Get "js/bible-search.js" }}
{{ if $search }}
<script src="{{ $search.RelPermalink }}" defer></script>
{{ end }}
{{ end }}

{{ define "main" }}
{{ $basePath := .Site.Params.michael.basePath | default "/religion/bibles" }}
<div class="bible-search-container">
  <header class="bible-search-header">
    <h1 class="bible-search-title">
      {{ .Title }}
    </h1>
    <p class="bible-search-description">
      {{ .Description }}
    </p>
  </header>

  <!-- Search Form -->
  <div class="bible-search-form-card card-paper">
    <form id="search-form" class="bible-search-form">
      <div class="bible-search-inputs">
        <div class="bible-search-query-group">
          <label for="search-query" class="bible-search-label">
            {{ i18n "searchQuery" | default "Search for" }}:
          </label>
          <input
            type="text"
            id="search-query"
            name="q"
            class="input-paper"
            placeholder="{{ i18n "searchPlaceholder" | default "word, \"exact phrase\", or H1234/G5678" }}"
            autocomplete="off"
          >
        </div>
        <div class="bible-search-bible-group">
          <label for="bible-select" class="bible-search-label">
            {{ i18n "selectBible" | default "Translation" }}:
          </label>
          <select id="bible-select" name="bible" class="input-paper">
            {{ range .Site.Data.bibles.bibles }}
            <option value="{{ .id }}">{{ .abbrev }} - {{ .title }}</option>
            {{ end }}
          </select>
        </div>
      </div>
      <div class="bible-search-options">
        <button type="submit" class="btn-paper-dark">
          {{ i18n "search" | default "Search" }}
        </button>
        <label class="bible-search-checkbox-label">
          <input type="checkbox" id="case-sensitive" class="bible-search-checkbox">
          {{ i18n "caseSensitive" | default "Case sensitive" }}
        </label>
        <label class="bible-search-checkbox-label">
          <input type="checkbox" id="whole-word" class="bible-search-checkbox">
          {{ i18n "wholeWord" | default "Whole word" }}
        </label>
      </div>
    </form>
  </div>

  <!-- Search Status -->
  <div id="search-status" class="bible-search-status hidden">
    {{ i18n "searching" | default "Searching..." }}
  </div>

  <!-- Search Results -->
  <div id="search-results" class="bible-search-results">
    <div class="bible-search-prompt">
      <p class="bible-search-prompt-text">{{ i18n "searchPrompt" | default "Enter a search term to find verses across the Bible." }}</p>
      <p class="bible-search-prompt-hint">{{ i18n "searchTypesHint" | default "Try: word, \"exact phrase\", or Strong's numbers (H430, G2316)" }}</p>
    </div>
  </div>

  <!-- Back Navigation -->
  <div class="bible-back-nav">
    <a href="{{ printf "%s/" $basePath | relLangURL }}" class="btn-paper">
      &larr; {{ i18n "allBibles" | default "All Bibles" }}
    </a>
  </div>
</div>

<!-- Bible Index Data for JavaScript - generated at build time -->
{{- $bibleIndex := dict -}}
{{- range $bible := .Site.Data.bibles.bibles -}}
  {{- $aux := index $.Site.Data.bibles_auxiliary $bible.id -}}
  {{- $books := slice -}}
  {{- with $aux -}}
    {{- range .books -}}
      {{- $books = $books | append (dict "id" .id "name" .name "chapters" (len .chapters)) -}}
    {{- end -}}
  {{- end -}}
  {{- $bibleIndex = $bibleIndex | merge (dict $bible.id (dict "title" $bible.title "abbrev" $bible.abbrev "books" $books)) -}}
{{- end -}}
<script id="bible-index" type="application/json">
{{ dict "bibles" $bibleIndex "basePath" ($basePath | relLangURL) | jsonify | safeJS }}
</script>
{{ end }}
