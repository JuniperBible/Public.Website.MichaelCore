{{ define "scripts" }}
{{ $textCompare := resources.Get "js/text-compare.js" }}
{{ if $textCompare }}
<script src="{{ $textCompare.RelPermalink }}" defer></script>
{{ end }}
{{ $parallel := resources.Get "js/parallel.js" }}
{{ if $parallel }}
<script src="{{ $parallel.RelPermalink }}" defer></script>
{{ end }}
{{ end }}

{{ define "main" }}
{{ $basePath := .Site.Params.michael.basePath | default "/religion/bibles" }}
<main>
  <header class="michael-header">
    <h1 class="font-hand">
      {{ .Title }}
    </h1>
    <p class="font-hand">
      {{ .Description }}
    </p>
  </header>

  <!-- Unified Selector Panel (Normal Mode) -->
  <section id="normal-mode">
    <article>
      <!-- All controls in one row -->
      <div class="bible-nav">
        <div class="nav-controls">
          <!-- Translations -->
          <fieldset id="translation-checkboxes" role="group">
            {{ range .Site.Data.bibles.bibles }}
            <label>
              <input type="checkbox"
                     class="translation-checkbox"
                     value="{{ .id }}"
                     data-abbrev="{{ .abbrev }}"
                     data-title="{{ .title }}">
              <span class="font-hand">{{ .title }} ({{ .abbrev }})</span>
            </label>
            {{ end }}
          </fieldset>
          <span role="separator" aria-hidden="true">|</span>
          <!-- Passage selectors -->
          <select id="book-select" aria-label="Select book">
            <option value="">Book...</option>
            {{ $firstBible := index .Site.Data.bibles.bibles 0 }}
            {{ $aux := index .Site.Data.bibles_auxiliary $firstBible.id }}
            {{ range $aux.books }}
            <option value="{{ .id }}">{{ .name }}</option>
            {{ end }}
          </select>
          <select id="chapter-select" aria-label="Select chapter" disabled>
            <option value="">Ch...</option>
          </select>
          <!-- Compare Differences with toggle and color picker -->
          <div class="nav-buttons">
            <label>
              <input type="checkbox" id="highlight-toggle">
              <span class="font-hand">Compare Differences</span>
            </label>
            <button id="highlight-color-btn" class="color-btn" style="background-color: #6b4c6b;" title="Choose highlight color" aria-label="Choose highlight color"></button>
            <div id="highlight-color-picker" class="color-picker hidden">
              <div class="color-grid">
                <!-- Default & Website colors -->
                <button class="color-option" data-color="#6b4c6b" title="Default Purple" style="background-color: #6b4c6b;" aria-label="Default Purple"></button>
                <button class="color-option" data-color="#8b5a8b" title="Website Purple" style="background-color: #8b5a8b;" aria-label="Website Purple"></button>
                <!-- Pastels -->
                <button class="color-option" data-color="#f4a4ba" title="Pastel Pink" style="background-color: #f4a4ba;" aria-label="Pastel Pink"></button>
                <button class="color-option" data-color="#a4d4f4" title="Pastel Blue" style="background-color: #a4d4f4;" aria-label="Pastel Blue"></button>
                <button class="color-option" data-color="#b4f4a4" title="Pastel Green" style="background-color: #b4f4a4;" aria-label="Pastel Green"></button>
                <button class="color-option" data-color="#f4e4a4" title="Pastel Yellow" style="background-color: #f4e4a4;" aria-label="Pastel Yellow"></button>
                <button class="color-option" data-color="#e4a4f4" title="Pastel Violet" style="background-color: #e4a4f4;" aria-label="Pastel Violet"></button>
                <!-- Neons -->
                <button class="color-option" data-color="#ff6b9d" title="Neon Pink" style="background-color: #ff6b9d;" aria-label="Neon Pink"></button>
                <button class="color-option" data-color="#6bfff4" title="Neon Cyan" style="background-color: #6bfff4;" aria-label="Neon Cyan"></button>
                <button class="color-option" data-color="#9dff6b" title="Neon Green" style="background-color: #9dff6b;" aria-label="Neon Green"></button>
                <button class="color-option" data-color="#ffeb6b" title="Neon Yellow" style="background-color: #ffeb6b;" aria-label="Neon Yellow"></button>
                <button class="color-option" data-color="#ff6b6b" title="Neon Red" style="background-color: #ff6b6b;" aria-label="Neon Red"></button>
                <button class="color-option" data-color="#6b9dff" title="Neon Blue" style="background-color: #6b9dff;" aria-label="Neon Blue"></button>
                <button class="color-option" data-color="#ff9d6b" title="Neon Orange" style="background-color: #ff9d6b;" aria-label="Neon Orange"></button>
                <button class="color-option" data-color="#d46bff" title="Neon Purple" style="background-color: #d46bff;" aria-label="Neon Purple"></button>
              </div>
            </div>
          </div>
          <!-- SSS Mode toggle -->
          <button id="sss-mode-btn" aria-label="Toggle Side by Side Scripture mode">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <polygon points="12,2 22,20 2,20" stroke-width="2" stroke-linejoin="round"/>
              <circle cx="12" cy="14" r="5" stroke-width="2"/>
              <circle cx="12" cy="14" r="1.5" fill="currentColor" stroke="none"/>
            </svg>
            <span class="font-hand"><strong>SSS</strong> <span id="sss-mode-status">OFF</span></span>
          </button>
        </div>
        <!-- Verse grid (shown when chapter is selected) -->
        <div id="verse-grid" class="hidden">
          <nav aria-label="Verse navigation">
            <span class="font-hand">v:</span>
            <button id="all-verses-btn" class="font-hand">All</button>
            <div id="verse-buttons" role="group"></div>
          </nav>
        </div>
      </div>
    </article>
  </section>

  <!-- SSS Mode (Side by Side Scripture) - Hidden by default -->
  <section id="sss-mode" class="hidden">
    <!-- SSS Controls -->
    <article>
      <div class="bible-nav">
        <div class="nav-controls">
          <button id="sss-back-btn" title="Back to Compare" aria-label="Back to Compare">&larr;</button>
          <select id="sss-bible-left" aria-label="Select left Bible">
            <option value="">Left Bible...</option>
            {{ range .Site.Data.bibles.bibles }}
            <option value="{{ .id }}">{{ .title }} ({{ .abbrev }})</option>
            {{ end }}
          </select>
          <select id="sss-bible-right" aria-label="Select right Bible">
            <option value="">Right Bible...</option>
            {{ range .Site.Data.bibles.bibles }}
            <option value="{{ .id }}">{{ .title }} ({{ .abbrev }})</option>
            {{ end }}
          </select>
          <span role="separator" aria-hidden="true">|</span>
          <select id="sss-book-select" aria-label="Select book">
            <option value="">Book...</option>
            {{ $firstBible := index .Site.Data.bibles.bibles 0 }}
            {{ $aux := index .Site.Data.bibles_auxiliary $firstBible.id }}
            {{ range $aux.books }}
            <option value="{{ .id }}">{{ .name }}</option>
            {{ end }}
          </select>
          <select id="sss-chapter-select" aria-label="Select chapter" disabled>
            <option value="">Ch...</option>
          </select>
          <!-- Compare Differences with toggle and color picker (SSS mode) -->
          <div class="nav-buttons">
            <label>
              <input type="checkbox" id="sss-highlight-toggle" checked>
              <span class="font-hand">Compare Differences</span>
            </label>
            <button id="sss-highlight-color-btn" class="color-btn" style="background-color: #6b4c6b;" title="Choose highlight color" aria-label="Choose highlight color"></button>
            <div id="sss-highlight-color-picker" class="color-picker hidden">
              <div class="color-grid">
                <!-- Default & Website colors -->
                <button class="sss-color-option color-option" data-color="#6b4c6b" title="Default Purple" style="background-color: #6b4c6b;" aria-label="Default Purple"></button>
                <button class="sss-color-option color-option" data-color="#8b5a8b" title="Website Purple" style="background-color: #8b5a8b;" aria-label="Website Purple"></button>
                <!-- Pastels -->
                <button class="sss-color-option color-option" data-color="#f4a4ba" title="Pastel Pink" style="background-color: #f4a4ba;" aria-label="Pastel Pink"></button>
                <button class="sss-color-option color-option" data-color="#a4d4f4" title="Pastel Blue" style="background-color: #a4d4f4;" aria-label="Pastel Blue"></button>
                <button class="sss-color-option color-option" data-color="#b4f4a4" title="Pastel Green" style="background-color: #b4f4a4;" aria-label="Pastel Green"></button>
                <button class="sss-color-option color-option" data-color="#f4e4a4" title="Pastel Yellow" style="background-color: #f4e4a4;" aria-label="Pastel Yellow"></button>
                <button class="sss-color-option color-option" data-color="#e4a4f4" title="Pastel Violet" style="background-color: #e4a4f4;" aria-label="Pastel Violet"></button>
                <!-- Neons -->
                <button class="sss-color-option color-option" data-color="#ff6b9d" title="Neon Pink" style="background-color: #ff6b9d;" aria-label="Neon Pink"></button>
                <button class="sss-color-option color-option" data-color="#6bfff4" title="Neon Cyan" style="background-color: #6bfff4;" aria-label="Neon Cyan"></button>
                <button class="sss-color-option color-option" data-color="#9dff6b" title="Neon Green" style="background-color: #9dff6b;" aria-label="Neon Green"></button>
                <button class="sss-color-option color-option" data-color="#ffeb6b" title="Neon Yellow" style="background-color: #ffeb6b;" aria-label="Neon Yellow"></button>
                <button class="sss-color-option color-option" data-color="#ff6b6b" title="Neon Red" style="background-color: #ff6b6b;" aria-label="Neon Red"></button>
                <button class="sss-color-option color-option" data-color="#6b9dff" title="Neon Blue" style="background-color: #6b9dff;" aria-label="Neon Blue"></button>
                <button class="sss-color-option color-option" data-color="#ff9d6b" title="Neon Orange" style="background-color: #ff9d6b;" aria-label="Neon Orange"></button>
                <button class="sss-color-option color-option" data-color="#d46bff" title="Neon Purple" style="background-color: #d46bff;" aria-label="Neon Purple"></button>
              </div>
            </div>
          </div>
          <button id="sss-toggle-btn" aria-label="Toggle Side by Side Scripture mode">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <polygon points="12,2 22,20 2,20" stroke-width="2" stroke-linejoin="round"/>
              <circle cx="12" cy="14" r="5" stroke-width="2"/>
              <circle cx="12" cy="14" r="1.5" fill="currentColor" stroke="none"/>
            </svg>
            <span class="font-hand"><strong>SSS</strong> <span id="sss-status">ON</span></span>
          </button>
        </div>
        <!-- SSS Verse grid (shown when chapter is selected) -->
        <div id="sss-verse-grid" class="hidden">
          <nav aria-label="Verse navigation">
            <span class="font-hand">v:</span>
            <button id="sss-all-verses-btn" class="font-hand">All</button>
            <div id="sss-verse-buttons" role="group"></div>
          </nav>
        </div>
      </div>
    </article>

    <!-- Side by Side Panes -->
    <div class="grid-2" id="sss-panes">
      <article class="parallel-pane" id="sss-left-pane">
        <p class="font-hand">Select a Bible</p>
      </article>
      <article class="parallel-pane" id="sss-right-pane">
        <p class="font-hand">Select a Bible</p>
      </article>
    </div>
  </section>

  <!-- Parallel Verse Display (Normal Mode) -->
  <section id="parallel-content">
    <p class="font-hand">
      {{ i18n "selectPassagePrompt" | default "Select 2+ translations and a passage to compare." }}
    </p>
  </section>

  <!-- Back Navigation -->
  <footer class="actions">
    <a href="{{ $basePath }}/" role="button">
      &larr; {{ i18n "allBibles" | default "All Bibles" }}
    </a>
  </footer>
</main>

<!-- Bible Data for JavaScript - book structure only, verses loaded on-demand -->
<script id="bible-data" type="application/json">
{{ $biblesMeta := slice }}
{{ range .Site.Data.bibles.bibles }}
  {{ $biblesMeta = $biblesMeta | append (dict "id" .id "title" .title "abbrev" .abbrev "description" .description "language" .language) }}
{{ end }}
{{ $firstBible := index .Site.Data.bibles.bibles 0 }}
{{ $aux := index .Site.Data.bibles_auxiliary $firstBible.id }}
{{ $booksList := slice }}
{{ range $aux.books }}
  {{ $booksList = $booksList | append (dict "id" .id "name" .name "chapters" (len .chapters)) }}
{{ end }}
{{ dict "bibles" $biblesMeta "books" $booksList "basePath" $basePath | jsonify | safeJS }}
</script>
{{ end }}
