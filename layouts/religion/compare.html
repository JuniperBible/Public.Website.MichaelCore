{{ define "scripts" }}
{{ $textCompare := resources.Get "js/text-compare.js" }}
{{ if $textCompare }}
<script src="{{ $textCompare.RelPermalink }}" defer></script>
{{ end }}
{{ $parallel := resources.Get "js/parallel.js" }}
{{ if $parallel }}
<script src="{{ $parallel.RelPermalink }}" defer></script>
{{ end }}
{{ end }}

{{ define "main" }}
{{ $basePath := .Site.Params.michael.basePath | default "/religion/bibles" }}
<div class="bible-compare-container">
  <header class="bible-compare-header">
    <h1 class="bible-compare-title">
      {{ .Title }}
    </h1>
    <p class="bible-compare-description">
      {{ .Description }}
    </p>
  </header>

  <!-- Unified Selector Panel (Normal Mode) -->
  <div id="normal-mode" class="bible-compare-panel card-paper">
    <!-- All controls in one row -->
    <div class="bible-compare-controls">
      <!-- Translations -->
      <div class="bible-compare-translations" id="translation-checkboxes">
        {{ range .Site.Data.bibles.bibles }}
        <label class="bible-compare-translation-label">
          <input type="checkbox"
                 class="translation-checkbox bible-compare-checkbox"
                 value="{{ .id }}"
                 data-abbrev="{{ .abbrev }}"
                 data-title="{{ .title }}">
          <span class="bible-compare-translation-text">{{ .title }} ({{ .abbrev }})</span>
        </label>
        {{ end }}
      </div>
      <span class="bible-compare-separator">|</span>
      <!-- Passage selectors -->
      <select id="book-select" class="bible-compare-select input-paper">
        <option value="">Book...</option>
        {{ $firstBible := index .Site.Data.bibles.bibles 0 }}
        {{ $aux := index .Site.Data.bibles_auxiliary $firstBible.id }}
        {{ range $aux.books }}
        <option value="{{ .id }}">{{ .name }}</option>
        {{ end }}
      </select>
      <select id="chapter-select" class="bible-compare-select input-paper" disabled>
        <option value="">Ch...</option>
      </select>
      <!-- Compare Differences with toggle and color picker -->
      <div class="bible-compare-highlight-controls">
        <label class="bible-compare-highlight-label">
          <input type="checkbox" id="highlight-toggle" class="bible-compare-checkbox">
          <span class="bible-compare-highlight-text">Compare Differences</span>
        </label>
        <button id="highlight-color-btn" class="bible-compare-color-btn" style="background-color: #6b4c6b;" title="Choose highlight color"></button>
        <div id="highlight-color-picker" class="bible-compare-color-picker hidden card-paper">
          <div class="bible-compare-color-grid">
            <!-- Default & Website colors -->
            <button class="color-option bible-compare-color-option" data-color="#6b4c6b" title="Default Purple"></button>
            <button class="color-option bible-compare-color-option" data-color="#8b5a8b" title="Website Purple"></button>
            <!-- Pastels -->
            <button class="color-option bible-compare-color-option" data-color="#f4a4ba" title="Pastel Pink"></button>
            <button class="color-option bible-compare-color-option" data-color="#a4d4f4" title="Pastel Blue"></button>
            <button class="color-option bible-compare-color-option" data-color="#b4f4a4" title="Pastel Green"></button>
            <button class="color-option bible-compare-color-option" data-color="#f4e4a4" title="Pastel Yellow"></button>
            <button class="color-option bible-compare-color-option" data-color="#e4a4f4" title="Pastel Violet"></button>
            <!-- Neons -->
            <button class="color-option bible-compare-color-option" data-color="#ff6b9d" title="Neon Pink"></button>
            <button class="color-option bible-compare-color-option" data-color="#6bfff4" title="Neon Cyan"></button>
            <button class="color-option bible-compare-color-option" data-color="#9dff6b" title="Neon Green"></button>
            <button class="color-option bible-compare-color-option" data-color="#ffeb6b" title="Neon Yellow"></button>
            <button class="color-option bible-compare-color-option" data-color="#ff6b6b" title="Neon Red"></button>
            <button class="color-option bible-compare-color-option" data-color="#6b9dff" title="Neon Blue"></button>
            <button class="color-option bible-compare-color-option" data-color="#ff9d6b" title="Neon Orange"></button>
            <button class="color-option bible-compare-color-option" data-color="#d46bff" title="Neon Purple"></button>
          </div>
        </div>
      </div>
      <!-- SSS Mode toggle -->
      <button id="sss-mode-btn" class="bible-compare-sss-btn">
        <svg class="bible-compare-sss-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <polygon points="12,2 22,20 2,20" stroke-width="2" stroke-linejoin="round"/>
          <circle cx="12" cy="14" r="5" stroke-width="2"/>
          <circle cx="12" cy="14" r="1.5" fill="currentColor" stroke="none"/>
        </svg>
        <span class="bible-compare-sss-text"><span class="bible-compare-sss-label">SSS</span> <span id="sss-mode-status">OFF</span></span>
      </button>
    </div>
    <!-- Verse grid (shown when chapter is selected) -->
    <div id="verse-grid" class="bible-compare-verse-grid hidden">
      <div class="bible-compare-verse-controls">
        <span class="bible-compare-verse-label">v:</span>
        <button id="all-verses-btn" class="bible-compare-all-verses-btn">All</button>
        <div class="bible-compare-verse-buttons" id="verse-buttons"></div>
      </div>
    </div>
  </div>

  <!-- SSS Mode (Side by Side Scripture) - Hidden by default -->
  <div id="sss-mode" class="hidden">
    <!-- SSS Controls -->
    <div class="bible-compare-panel card-paper">
      <div class="bible-compare-controls">
        <button id="sss-back-btn" class="bible-compare-back-btn" title="Back to Compare">&larr;</button>
        <select id="sss-bible-left" class="bible-compare-select input-paper">
          <option value="">Left Bible...</option>
          {{ range .Site.Data.bibles.bibles }}
          <option value="{{ .id }}">{{ .title }} ({{ .abbrev }})</option>
          {{ end }}
        </select>
        <select id="sss-bible-right" class="bible-compare-select input-paper">
          <option value="">Right Bible...</option>
          {{ range .Site.Data.bibles.bibles }}
          <option value="{{ .id }}">{{ .title }} ({{ .abbrev }})</option>
          {{ end }}
        </select>
        <span class="bible-compare-separator">|</span>
        <select id="sss-book-select" class="bible-compare-select input-paper">
          <option value="">Book...</option>
          {{ $firstBible := index .Site.Data.bibles.bibles 0 }}
          {{ $aux := index .Site.Data.bibles_auxiliary $firstBible.id }}
          {{ range $aux.books }}
          <option value="{{ .id }}">{{ .name }}</option>
          {{ end }}
        </select>
        <select id="sss-chapter-select" class="bible-compare-select input-paper" disabled>
          <option value="">Ch...</option>
        </select>
        <!-- Compare Differences with toggle and color picker (SSS mode) -->
        <div class="bible-compare-highlight-controls">
          <label class="bible-compare-highlight-label">
            <input type="checkbox" id="sss-highlight-toggle" class="bible-compare-checkbox" checked>
            <span class="bible-compare-highlight-text">Compare Differences</span>
          </label>
          <button id="sss-highlight-color-btn" class="bible-compare-color-btn" style="background-color: #6b4c6b;" title="Choose highlight color"></button>
          <div id="sss-highlight-color-picker" class="bible-compare-color-picker hidden card-paper">
            <div class="bible-compare-color-grid">
              <!-- Default & Website colors -->
              <button class="sss-color-option bible-compare-color-option" data-color="#6b4c6b" title="Default Purple"></button>
              <button class="sss-color-option bible-compare-color-option" data-color="#8b5a8b" title="Website Purple"></button>
              <!-- Pastels -->
              <button class="sss-color-option bible-compare-color-option" data-color="#f4a4ba" title="Pastel Pink"></button>
              <button class="sss-color-option bible-compare-color-option" data-color="#a4d4f4" title="Pastel Blue"></button>
              <button class="sss-color-option bible-compare-color-option" data-color="#b4f4a4" title="Pastel Green"></button>
              <button class="sss-color-option bible-compare-color-option" data-color="#f4e4a4" title="Pastel Yellow"></button>
              <button class="sss-color-option bible-compare-color-option" data-color="#e4a4f4" title="Pastel Violet"></button>
              <!-- Neons -->
              <button class="sss-color-option bible-compare-color-option" data-color="#ff6b9d" title="Neon Pink"></button>
              <button class="sss-color-option bible-compare-color-option" data-color="#6bfff4" title="Neon Cyan"></button>
              <button class="sss-color-option bible-compare-color-option" data-color="#9dff6b" title="Neon Green"></button>
              <button class="sss-color-option bible-compare-color-option" data-color="#ffeb6b" title="Neon Yellow"></button>
              <button class="sss-color-option bible-compare-color-option" data-color="#ff6b6b" title="Neon Red"></button>
              <button class="sss-color-option bible-compare-color-option" data-color="#6b9dff" title="Neon Blue"></button>
              <button class="sss-color-option bible-compare-color-option" data-color="#ff9d6b" title="Neon Orange"></button>
              <button class="sss-color-option bible-compare-color-option" data-color="#d46bff" title="Neon Purple"></button>
            </div>
          </div>
        </div>
        <button id="sss-toggle-btn" class="bible-compare-sss-btn">
          <svg class="bible-compare-sss-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <polygon points="12,2 22,20 2,20" stroke-width="2" stroke-linejoin="round"/>
            <circle cx="12" cy="14" r="5" stroke-width="2"/>
            <circle cx="12" cy="14" r="1.5" fill="currentColor" stroke="none"/>
          </svg>
          <span class="bible-compare-sss-text"><span class="bible-compare-sss-label">SSS</span> <span id="sss-status">ON</span></span>
        </button>
      </div>
      <!-- SSS Verse grid (shown when chapter is selected) -->
      <div id="sss-verse-grid" class="bible-compare-verse-grid hidden">
        <div class="bible-compare-verse-controls">
          <span class="bible-compare-verse-label">v:</span>
          <button id="sss-all-verses-btn" class="bible-compare-all-verses-btn">All</button>
          <div class="bible-compare-verse-buttons" id="sss-verse-buttons"></div>
        </div>
      </div>
    </div>

    <!-- Side by Side Panes -->
    <div class="bible-compare-sss-panes" id="sss-panes">
      <div class="bible-compare-sss-pane card-paper" id="sss-left-pane">
        <div class="bible-compare-sss-placeholder">Select a Bible</div>
      </div>
      <div class="bible-compare-sss-pane card-paper" id="sss-right-pane">
        <div class="bible-compare-sss-placeholder">Select a Bible</div>
      </div>
    </div>
  </div>

  <!-- Parallel Verse Display (Normal Mode) -->
  <div id="parallel-content" class="bible-compare-parallel">
    <div class="bible-compare-parallel-placeholder">
      {{ i18n "selectPassagePrompt" | default "Select 2+ translations and a passage to compare." }}
    </div>
  </div>

  <!-- Back Navigation -->
  <div class="bible-back-nav">
    <a href="{{ printf "%s/" $basePath | relLangURL }}" class="btn-paper">
      &larr; {{ i18n "allBibles" | default "All Bibles" }}
    </a>
  </div>
</div>

<!-- Bible Data for JavaScript - book structure only, verses loaded on-demand -->
<script id="bible-data" type="application/json">
{{ $biblesMeta := slice }}
{{ range .Site.Data.bibles.bibles }}
  {{ $biblesMeta = $biblesMeta | append (dict "id" .id "title" .title "abbrev" .abbrev "description" .description "language" .language) }}
{{ end }}
{{ $firstBible := index .Site.Data.bibles.bibles 0 }}
{{ $aux := index .Site.Data.bibles_auxiliary $firstBible.id }}
{{ $booksList := slice }}
{{ range $aux.books }}
  {{ $booksList = $booksList | append (dict "id" .id "name" .name "chapters" (len .chapters)) }}
{{ end }}
{{ dict "bibles" $biblesMeta "books" $booksList "basePath" ($basePath | relLangURL) | jsonify | safeJS }}
</script>
{{ end }}
