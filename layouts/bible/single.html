{{/*
  Template: single.html
  Purpose: Bible chapter display page

  Features:
  - Chapter text with verse numbers
  - Strong's number tooltips (for translations with Strong's data)
  - Verse sharing buttons
  - Previous/Next chapter navigation
  - Book/Chapter navigation dropdown

  Data Sources:
  - .Params: Page front matter (bible, book, chapter)
  - .Site.Data.bibles.bibles: Bible metadata
  - .Site.Data.bibles_auxiliary: Book/chapter structure
  - .Content: Rendered verse content

  JavaScript Dependencies:
  - strongs.js: Strong's number tooltips
  - share.js: Verse sharing
  - michael/share-menu.js: Share menu component

  URL Parameters:
  - v: Verse number (scroll to and highlight)
*/}}

{{ define "scripts" }}
{{/* Inject Strong's definitions data (cached â€” identical across all pages) */}}
{{ partialCached "michael/strongs-data.html" . }}
{{/* Load each JS resource if it exists - dom-utils.js must be first as other modules depend on it */}}
{{ range slice "js/michael/dom-utils.js" "js/michael/bible-nav.js" "js/michael/share-menu.js" "js/share.js" "js/strongs.js" "js/michael/footnotes.js" }}
  {{ with resources.Get . }}<script type="module" src="{{ .RelPermalink }}" defer></script>{{ end }}
{{ end }}
{{ end }}

{{ define "main" }}
{{ $basePath := .Site.Params.michael.basePath | default "/bible" }}
<main class="container pad-3-2">
  <article class="panel">
    {{/* Look up Bible metadata from bibles-data partial (includes overrides) */}}
    {{ $bibleId := .Params.bible | default .Params.abbrev | default .File.ContentBaseName }}
    {{ $bibleData := dict }}
    {{ range (partialCached "michael/bible-data.html" .Site) }}
      {{ if eq .id $bibleId }}
        {{ $bibleData = . }}
      {{ end }}
    {{ end }}

    {{ partial "michael/bible-single-header.html" (dict "page" . "bibleData" $bibleData) }}

    <!-- Bible chapter content or book navigation -->
    {{ partial "michael/bible-single-content.html" (dict "page" . "basePath" $basePath) }}

    <!-- Navigation -->
    {{ partial "michael/bible-single-nav.html" (dict "page" . "basePath" $basePath) }}
  </article>
</main>
{{ end }}
