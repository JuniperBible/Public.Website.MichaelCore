{{/*
  Template: baseof.html
  Purpose: Base HTML template for all pages

  Blocks:
  - "main": Page content
  - "scripts": Page-specific JavaScript

  Security:
  - CSP meta tag restricts resource loading
  - unsafe-inline required for Hugo's style fingerprinting

  Note: For production with custom domains, consider moving CSP to HTTP headers
*/}}
<!doctype html>
<html lang="{{ .Site.Language.Lang | default "en" }}" data-hugo-env="{{ hugo.Environment }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>{{- if .IsHome -}}{{ .Site.Title }}{{- else -}}{{ .Title }} | {{ .Site.Title }}{{- end -}}</title>
  {{ $desc := or .Description (.Summary | plainify) .Site.Params.description }}
  <meta name="description" content="{{ $desc }}">
  {{/* Content Security Policy - restrictive by default */}}
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self'; font-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self';">
  {{ with .Permalink }}<link rel="canonical" href="{{ . }}">{{ end }}
  {{ with .OutputFormats.Get "rss" }}<link rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}" href="{{ .Permalink }}">{{ end }}
  {{- template "_internal/opengraph.html" . -}}
  {{- template "_internal/twitter_cards.html" . -}}

  {{/* Focus with Justin — Starter Theme (concatenate modular CSS files) */}}
  {{ partial "michael/css-bundle.html" . }}

  {{/* PWA Support */}}
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1a3230">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Michael">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16.png">
</head>
<body>
  <a href="#main-content" class="skip-link">{{ i18n "skipToContent" | default "Skip to content" }}</a>
  {{ partial "header.html" . }}

  {{ block "main" . }}{{ end }}{{/* main content block — pages should include id="main-content" */}}

  {{ partial "footer.html" . }}

  {{/* Page-specific scripts */}}
  {{ block "scripts" . }}{{ end }}

  {{/* Service Worker registration */}}
  {{ partial "michael/sw-register.html" . }}

  {{/* Shared Utilities and PWA Core Scripts */}}
  {{ partial "michael/pwa-scripts.html" . }}

  {{/* PWA Install Banner */}}
  {{ partial "michael/pwa-install-banner.html" . }}

  {{/* Detect PWA standalone mode */}}
  {{ partial "michael/pwa-detect.html" . }}
</body>
</html>
