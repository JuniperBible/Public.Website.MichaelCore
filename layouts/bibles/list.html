{{/*
================================================================================
FILE: layouts/bibles/list.html
PURPOSE: Bible translations list/grid page
DESCRIPTION: Displays available Bible translations as filterable cards with
             tags, allowing users to browse and select translations for
             reading or comparison. Includes offline settings panel for
             cache management.

DEPENDENCIES:
  - Data: .Site.Data.bibles (bibles.json)
  - Data: .Site.Data.bibles_auxiliary (per-translation data)
  - CSS: assets/css/theme.css (.card, .grid-2, .badge, offline-settings, etc.)
  - JS: assets/js/michael/offline-manager.js - Cache management API
  - JS: assets/js/michael/offline-settings-ui.js - UI initialization
  - Partial: partials/michael/offline-settings.html - Settings panel markup
  - i18n: compareTranslations, searchBible
  - Config: .Site.Params.michael.basePath

TEMPLATE VARIABLES:
  - .Title: Page title from front matter
  - .Description: Page description from front matter
  - .Site.Data.bibles.bibles: Array of Bible metadata objects

DATA STRUCTURE (bibles.json):
  {
    "id": "kjv",
    "title": "King James Version",
    "abbrev": "KJV",
    "language": "English",
    "versification": "kjva",
    "license": "CC-PDDC"
  }

URL PATTERN: /bibles/ or /{lang}/bibles/

RELATED:
  - layouts/bibles/single.html - Individual chapter view
  - layouts/bibles/compare.html - Translation comparison
  - layouts/bibles/search.html - Bible search
  - static/sw.js - Service worker for offline support
================================================================================
*/}}

{{/*
================================================================================
SCRIPTS BLOCK
Load offline functionality JavaScript modules.
These are loaded with defer to avoid blocking page rendering.
================================================================================
*/}}
{{ define "scripts" }}
{{ $offlineManager := resources.Get "js/michael/offline-manager.js" }}
{{ if $offlineManager }}<script src="{{ $offlineManager.RelPermalink }}" defer></script>{{ end }}
{{ $offlineUI := resources.Get "js/michael/offline-settings-ui.js" }}
{{ if $offlineUI }}<script src="{{ $offlineUI.RelPermalink }}" defer></script>{{ end }}
{{ end }}

{{ define "main" }}
{{ $basePath := .Site.Params.michael.basePath | default "/bibles" }}
<main class="container pad-3-2">
  <div class="panel">
    {{/*
    ============================================================================
    PAGE HEADER
    Displays the page title and optional description from front matter.
    ============================================================================
    */}}
    <header class="page-header">
      <h1>{{ .Title }}</h1>
      {{ with .Description }}<p>{{ . }}</p>{{ end }}
    </header>

    {{/*
    ============================================================================
    QUICK NAVIGATION LINKS
    Provides shortcuts to comparison and search features.
    Links use relLangURL for multilingual support.
    ============================================================================
    */}}
    <nav class="actions mb-2">
      <a href="{{ printf "%s/compare/" $basePath | relLangURL }}" class="btn btn--secondary">
        {{ i18n "compareTranslations" | default "Compare Translations" }}
      </a>
      <a href="{{ printf "%s/search/" $basePath | relLangURL }}" class="btn btn--secondary">
        {{ i18n "searchBible" | default "Search Bible" }}
      </a>
    </nav>

    {{/*
    ============================================================================
    BIBLE TRANSLATIONS GRID
    Renders all available Bible translations as clickable cards in a 2-column
    responsive grid. Each card displays:
      - Title: Full translation name
      - Abbreviation: Short form (e.g., KJV, NIV)
      - Language badge: If .language is set
      - License badge: If .license is set

    Cards link to the individual translation's chapter browser page.
    Data source: .Site.Data.bibles.bibles array from data/bibles.json
    ============================================================================
    */}}
    <section class="grid-2">
      {{ range .Site.Data.bibles.bibles }}
      <a href="{{ printf "%s/%s/" $basePath .id | relLangURL }}" class="card">
        <h2 class="card__title">{{ .title }}</h2>
        <p class="card__meta">{{ .abbrev }}</p>
        <div class="row mt-1">
          {{ with .language }}
          <span class="badge">{{ . }}</span>
          {{ end }}
          {{ with .license }}
          <span class="badge">{{ . }}</span>
          {{ end }}
        </div>
      </a>
      {{ end }}
    </section>

    {{/*
    ============================================================================
    OFFLINE SETTINGS PANEL
    Collapsible panel for managing offline Bible content and cache.
    Allows users to download translations for offline reading and manage cache.
    Requires offline-manager.js for functionality.
    ============================================================================
    */}}
    {{ partial "michael/offline-settings.html" (dict "page" . "basePath" $basePath) }}
  </div>
</main>
{{ end }}
