# Documentation

Welcome to the Focus with Justin documentation. This site is built with Hugo, the AirFold theme, and deployed on Cloudflare Pages.

## Quick Start

```bash
nix-shell                              # Enter dev environment
npm install                            # Install dependencies
npm run dev                            # Start dev server at localhost:1313
```

## Development Process

**All features must be documented and tested.** Follow this process:

```
1. Document Behavior  →  Describe what the feature should do
2. Write Tests        →  Create tests that verify the documented behavior
3. Write Code         →  Implement the feature to pass the tests
4. Test               →  Run all tests to confirm nothing broke
```

## Quick Reference

| I want to... | Read... |
|--------------|---------|
| Set up development environment | [Development Guide](development.md#quick-start) |
| Understand the codebase | [Architecture Guide](architecture.md) |
| Configure the site | [Configuration Reference](configuration.md) |
| Deploy to production | [Deployment Guide](deployment.md) |
| Work with the Bible section | [Religion Section Guide](religion-section.md) |
| Set up the contact form | [Contact Form Guide](contact-form.md) |
| Run tests | [Testing Guide](testing.md) |
| Understand SWORD binary format | [Data Structures](data_structures.md) |

## Documentation Index

### Getting Started

| Document | Description |
|----------|-------------|
| [Development Guide](development.md) | Prerequisites, quick start, available commands, workflows |
| [Architecture Guide](architecture.md) | System overview, data-driven patterns, theme structure |

### Configuration

| Document | Description |
|----------|-------------|
| [Configuration Reference](configuration.md) | Complete hugo.toml reference, environment variables, i18n |

### Features

| Document | Description |
|----------|-------------|
| [Religion Section Guide](religion-section.md) | Bible features, SWORD converter, versification |
| [Contact Form Guide](contact-form.md) | CAPTCHA setup, email worker, security features |

### Operations

| Document | Description |
|----------|-------------|
| [Deployment Guide](deployment.md) | Cloudflare Pages, workers, service bindings |
| [Testing Guide](testing.md) | Test strategy, coverage goals, running tests |

### Technical Reference

| Document | Description |
|----------|-------------|
| [Data Structures](data_structures.md) | SWORD binary format documentation (zText, zCom, zLD) |

### Project Management

| Document | Description |
|----------|-------------|
| [STEPBible Interface Charter](stepbible-interface-charter.md) | Bible UI roadmap (10 phases, 3 complete) |
| [`TODO.txt`](../TODO.txt) | Current tasks and backlog |
| [`attic/docs/`](../attic/docs/) | Archived completed charters |

## Key Concepts

### Data-Driven Content

The site uses JSON data files instead of markdown for structured content:

```
data/
├── bibles.json              # Bible translation metadata
├── bibles_auxiliary/        # Full Bible content (~5MB each)
├── certifications.json      # Certification metadata
├── certifications_auxiliary.json
├── skills.json, tools.json  # Skills and tools
└── book_mappings.json       # Canonical status per tradition
```

Pages are generated by `_content.gotmpl` templates that read JSON and call `$.AddPage`.

### Theme Extensions

Reusable content types live in `themes/airfold/extensions/`:

| Extension | Description |
|-----------|-------------|
| `certifications/` | Professional certifications |
| `religion/` | Bible translations |
| `resume/` | CV/resume layouts |
| `portfolio/` | Project galleries |

### Module Mounts

Content is mapped to URLs via `hugo.toml`:

```toml
[[module.mounts]]
  source = 'themes/airfold/extensions/religion/content/bibles'
  target = 'content/religion/bibles'
```

### Security Architecture

```
Browser → Pages Function → CAPTCHA Verify → HMAC Sign → Email Worker → Inbox
```

- CAPTCHA: Cloudflare Turnstile (or 4 other providers)
- HMAC: SHA-256 with shared secret
- Email: Cloudflare Email Routing

## Project Structure

```
.
├── content/              # Markdown content (blog, projects)
├── data/                 # JSON data files
├── docs/                 # This documentation
├── functions/            # Cloudflare Pages Functions
├── i18n/                 # Internationalization strings
├── layouts/              # Site-specific layout overrides
├── static/               # Static assets
├── themes/airfold/       # AirFold theme
├── tools/juniper/# Go tool for Bible extraction
└── workers/              # Cloudflare Workers
```

## Commands Reference

### npm Commands

| Command | Description |
|---------|-------------|
| `npm run dev` | Start dev server with hot reload |
| `npm run build` | Build for production |
| `npm run test:sword` | Run SWORD converter tests |
| `npm run test:security` | Run contact form security tests |

### just Commands (Bible Management)

| Command | Description |
|---------|-------------|
| `just bible-sources` | List remote SWORD sources |
| `just bible-list` | List installed modules |
| `just bible-available` | List modules from CrossWire |
| `just bible-download <mod>` | Download a module |
| `just bible-verify` | Verify all module integrity |
| `just bible-convert` | Convert to Hugo JSON |
| `just bible-add <mod>` | Download + convert workflow |
| `just bible-download-all` | Bulk download from source |
| `just bible-download-mega` | Bulk download from ALL sources |

## Getting Help

| Issue | Solution |
|-------|----------|
| Development issues | Check [Development Guide](development.md#troubleshooting) |
| Deployment issues | Check [Deployment Guide](deployment.md#troubleshooting) |
| Contact form issues | Check [Contact Form Guide](contact-form.md#troubleshooting) |

## Contributing

1. Read the [Development Guide](development.md) for setup
2. Check [Architecture Guide](architecture.md) to understand patterns
3. Follow existing code style
4. Document your changes in the appropriate docs file
5. Write tests for new functionality
6. Run tests before committing: `npm run build && npm run test:sword`

## Technology Stack

| Layer | Technology |
|-------|------------|
| Static Site Generator | Hugo (extended) |
| Theme | AirFold (paper aesthetic) |
| CSS | Tailwind CSS v4 |
| Hosting | Cloudflare Pages |
| Functions | Cloudflare Pages Functions |
| Email | Cloudflare Email Routing + Workers |
| CAPTCHA | Cloudflare Turnstile |
| Bible Parser | Go (SWORD library) |
