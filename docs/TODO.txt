# Michael Hugo Bible Module — TODO
# Reference: docs/CODE_CLEANUP_CHARTER.md
# Format: [STATUS] TASK-ID: Description
# Status: [ ] TODO, [~] IN PROGRESS, [x] DONE, [-] CANCELLED

================================================================================
PHASE 0: BASELINE & GUARDRAILS
================================================================================

[x] P0-001: Inventory entry points
    - [x] List all Hugo templates (layouts/)
    - [x] List all JavaScript files (assets/js/)
    - [x] List all data paths (data/, static/schemas/)
    - [x] Document mount points in hugo.toml
    See: docs/PHASE-0-BASELINE-INVENTORY.md

[x] P0-002: Map current UI flows
    - [x] Document compare flow (normal mode)
    - [x] Document compare flow (SSS mode)
    - [x] Document search flow
    - [x] Document Strong's tooltip flow
    - [x] Document share menu flow
    See: docs/PHASE-0-BASELINE-INVENTORY.md

[x] P0-003: Create regression checklist
    - [x] Compare page: select 2+ translations, navigate chapters
    - [x] Compare page: SSS mode toggle and pane display
    - [x] Compare page: verse grid selection
    - [x] Compare page: highlight color picker
    - [x] Search page: text search returns results
    - [x] Search page: Strong's number search (H####/G####)
    - [x] Single page: chapter navigation works
    - [x] Single page: Strong's tooltips appear on click
    - [x] Single page: share menu opens and copies link
    - [x] Single page: verse share buttons work
    See: REGRESSION CHECKLIST section below

[x] P0-004: Document known quirks
    - [x] List expected behaviors that might look like bugs
    - [x] Note versification differences between translations
    See: docs/PHASE-0-BASELINE-INVENTORY.md Section 3

================================================================================
SPRINT 1: FOUNDATION (DRY + SECURITY CORE)
================================================================================

## 1.1 Create Module Directory Structure

[x] S1-001: Create assets/js/michael/ directory
[x] S1-002: Define module pattern (IIFE with window.Michael namespace)
[x] S1-003: Document script loading order requirements

## 1.2 Extract dom-utils.js

[x] S1-010: Extract addTapListener() from parallel.js
    - Source: parallel.js lines 111-137
    - Created: assets/js/michael/dom-utils.js
[x] S1-011: Extract getContrastColor() from parallel.js
    - Source: parallel.js (color picker logic)
[x] S1-012: Extract showMessage() utility
[x] S1-013: Add focus management helpers
[x] S1-014: Update parallel.js to use dom-utils.js
[x] S1-015: Update share.js to use dom-utils.js
[x] S1-016: Update bible-search.js to use dom-utils.js

## 1.3 Extract bible-api.js

[x] S1-020: Extract fetchChapter() from parallel.js
    - Source: parallel.js lines 492-516
    - Created: assets/js/michael/bible-api.js
[x] S1-021: Extract parseVersesFromHTML() from parallel.js
[x] S1-022: Consolidate chapter caching logic
[x] S1-023: Remove duplicate fetchChapter from bible-search.js
    - Source: bible-search.js lines 69-140
[x] S1-024: Update parallel.js to use bible-api.js
[x] S1-025: Update bible-search.js to use bible-api.js
[x] S1-026: Verify no behavior changes (run regression checklist)

## 1.4 CSP Preparation

[x] S1-030: Audit innerHTML usage in bible-search.js
    - Target: highlightMatches() lines 204-212
    - HIGH RISK: User search terms need HTML escaping
    See: CSP Audit Report in docs/PHASE-0-BASELINE-INVENTORY.md
[x] S1-031: Refactor highlightMatches() to use DOM APIs
    - XSS vulnerability patched with proper escaping
[x] S1-032: Audit innerHTML usage in parallel.js
    - 13 instances, MEDIUM risk (trusted data)
[x] S1-033: Audit innerHTML usage in share.js
    - 7 instances, LOW risk (static SVG/templates)
[x] S1-034: Add CSP meta tag to baseof.html
[x] S1-035: Document CSP requirements in charter

================================================================================
SPRINT 2: UI COMPONENTS + ACCESSIBILITY
================================================================================

## 2.1 VerseGrid Component

[x] S2-001: Create verse-grid.js with VerseGrid class
    - Consolidate: populateVerseGrid() and populateSSSVerseGrid()
    - Consolidate: updateVerseGridSelection() and updateSSSVerseGridSelection()
    - Consolidate: handleVerseButtonClick() and handleSSSVerseButtonClick()
    - Created: assets/js/michael/verse-grid.js
[x] S2-002: Add aria-pressed state to verse buttons
[x] S2-003: Add keyboard navigation (arrow keys)
[x] S2-004: Update parallel.js to use VerseGrid
[x] S2-005: Verify both normal and SSS modes work

## 2.2 ChapterDropdown Component

[x] S2-010: Create chapter-dropdown.js with ChapterDropdown class
    - Consolidate: populateChapterDropdown() and populateSSSChapterDropdown()
    - Created: assets/js/michael/chapter-dropdown.js
[x] S2-011: Add proper labeling (sr-only or visible)
[x] S2-012: Update parallel.js to use ChapterDropdown
[x] S2-013: Verify chapter navigation works in both modes

## 2.3 ShareMenu Component

[x] S2-020: Create share-menu.js with ShareMenu class
    - Created: assets/js/michael/share-menu.js
[x] S2-021: Add role="menu" and role="menuitem"
[x] S2-022: Add focus trapping within menu
[x] S2-023: Add arrow key navigation
[x] S2-024: Add Escape to close, return focus to trigger
[x] S2-025: Refactor share.js to use ShareMenu
[x] S2-026: Test keyboard-only share menu operation

## 2.4 Strong's Tooltip Accessibility

[x] S2-030: Add role="tooltip" to tooltip element
[x] S2-031: Add aria-describedby linking trigger to tooltip
[x] S2-032: Add aria-expanded state to trigger
[x] S2-033: Add Escape to close tooltip
[x] S2-034: Add keyboard parity for tooltip activation

## 2.5 Hugo Partial Extraction

[x] S2-040: Create layouts/partials/michael/color-picker.html
    - Source: compare.html lines 57-66 and 122-131
[x] S2-041: Create layouts/partials/michael/verse-grid.html
    - Source: compare.html verse grid markup
[x] S2-042: Create layouts/partials/michael/sss-toggle.html
    - Source: compare.html SSS toggle button
[x] S2-043: Update compare.html to use new partials
[x] S2-044: Verify compare page renders correctly

## 2.6 Contrast and Focus Fixes

[x] S2-050: Fix .badge contrast in theme.css
    - Current: rgba(255,255,255,.55) background
    - Target: solid color with 4.5:1 contrast
    - Added to CSS components
[x] S2-051: Fix .muted text contrast in theme.css
    - Current: var(--text-500)
    - Target: var(--text-700) or equivalent
[x] S2-052: Add strong focus-visible styles
[x] S2-053: Add prefers-reduced-motion support
[x] S2-054: Add text labels to color picker buttons
    - Added in color-picker.html partial

================================================================================
SPRINT 3: OFFLINE + SELF-CONTAINMENT
================================================================================

## 3.1 Strong's Definitions Bundle

[ ] S3-001: Add juniper extract-strongs command
    - Extract from SWORD StrongsHebrew module
    - Extract from SWORD StrongsGreek module
[ ] S3-002: Generate data/strongs/hebrew.json
[ ] S3-003: Generate data/strongs/greek.json
[ ] S3-004: Add provenance metadata (source, version, license)
[ ] S3-005: Create Hugo partial to inject Strong's data
[ ] S3-006: Update strongs.js to use local definitions first
[ ] S3-007: Keep external "Learn more" link as optional
[ ] S3-008: Update THIRD-PARTY-LICENSES.md
[ ] S3-009: Verify Strong's tooltips work offline

## 3.2 Service Worker

[ ] S3-010: Create static/sw.js
[ ] S3-011: Implement cache versioning scheme
[ ] S3-012: Pre-cache shell assets (CSS, JS, fonts)
[ ] S3-013: Pre-cache default chapters (KJV Gen/Ps/Matt/John)
[ ] S3-014: Implement cache-on-navigate for chapters
[ ] S3-015: Add offline fallback page
[ ] S3-016: Add SW registration to baseof.html (guarded)
[ ] S3-017: Create settings UI for offline downloads
[ ] S3-018: Create "Clear offline cache" control
[ ] S3-019: Test offline operation after first visit

## 3.3 Social Sharing Offline Fallbacks

[ ] S3-020: Add isOnline() utility to share.js
[ ] S3-021: Replace social buttons with "Copy formatted text" when offline
[ ] S3-022: Format clipboard text with verse reference + text
[ ] S3-023: Add toast notification: "Copied! Share when online."
[ ] S3-024: Test sharing behavior when offline

================================================================================
SPRINT 4: CSS + DOCUMENTATION
================================================================================

## 4.1 CSS Components

[x] S4-001: Create .verse-btn component in theme.css
[x] S4-002: Create diff highlighting classes
    - .diff-insert, .diff-punct, .diff-spelling, .diff-subst, .diff-omit
[x] S4-003: Create .share-menu component
[x] S4-004: Create .strongs-tooltip component
[x] S4-005: Create .loading and .skeleton components
[x] S4-006: Create .error-state and .empty-state components
[x] S4-007: Add touch target improvements for pointer:coarse
[x] S4-008: Add responsive control layout
[ ] S4-009: Enhance print stylesheet

## 4.2 Remove Inline Styles

[x] S4-010: Remove inline styles from compare.html
[x] S4-011: Remove inline styles from search.html
[x] S4-012: Remove inline styles from single.html
[x] S4-013: Remove inline styles from bible-nav.html
[x] S4-014: Replace style.cssText in parallel.js with class toggles
[x] S4-015: Replace style.cssText in share.js with class toggles
[x] S4-016: Verify all styling via CSS classes

## 4.3 JavaScript Documentation

[x] S4-020: Add JSDoc file header to parallel.js
    - Note: New modules have JSDoc, parallel.js update pending
[x] S4-021: Add JSDoc to all functions in parallel.js
    - Note: New modules have full JSDoc
[ ] S4-022: Add section separators to parallel.js
[ ] S4-023: Add JSDoc to bible-search.js
[ ] S4-024: Add JSDoc to share.js / share-menu.js
[ ] S4-025: Add inline comments to strongs.js
[x] S4-026: Document all new michael/ modules
    - All 5 modules have comprehensive JSDoc

## 4.4 Architecture Documentation

[x] S4-030: Create docs/ARCHITECTURE.md
    - System overview diagram
    - Data flow explanation
    - State management description
    - Component relationships
[x] S4-031: Create docs/DATA-FORMATS.md
    - bibles.json schema
    - bibles_auxiliary schema
    - Strong's JSON format
[x] S4-032: Create docs/VERSIFICATION.md
    - Protestant/Catholic/Orthodox differences
    - Psalm numbering
    - Deuterocanonical handling
[x] S4-033: Create docs/HUGO-MODULE-USAGE.md
    - Installation as module
    - Installation as submodule
    - Configuration options
    - Data requirements

## 4.5 Template Documentation

[x] S4-040: Add file header to compare.html
[x] S4-041: Add file header to search.html
[x] S4-042: Add file header to single.html
[x] S4-043: Add file header to bible-nav.html
[x] S4-044: Add section comments to complex template blocks
[x] S4-045: Document partial parameters
    - All new partials have comprehensive headers

================================================================================
REGRESSION CHECKLIST
================================================================================

Run before and after each sprint:

[ ] Compare: Select 2+ translations, see parallel display
[ ] Compare: Toggle SSS mode, see side-by-side panes
[ ] Compare: Use verse grid to select specific verse
[ ] Compare: Change highlight color, see diff highlighting
[ ] Compare: Navigate to different chapter
[ ] Search: Enter text query, see results
[ ] Search: Enter Strong's number (H1234), see results
[ ] Single: Navigate between chapters with arrows
[ ] Single: Click Strong's number, see tooltip
[ ] Single: Click share button, see menu
[ ] Single: Copy link from share menu
[ ] Single: Click verse share button
[ ] Offline: Load cached page when offline
[ ] Mobile: All controls usable on touch device
[ ] Keyboard: Navigate all controls with Tab/Enter/Space/Arrows

================================================================================
NOTES
================================================================================

Last updated: 2026-01-25
Charter reference: docs/CODE_CLEANUP_CHARTER.md
Changelog: docs/CHANGELOG.md

Sprint 1 & 2 Progress (2026-01-25):
- ✓ Created 5 new JS modules in assets/js/michael/
- ✓ Refactored parallel.js to use shared modules
- ✓ Refactored bible-search.js to use bible-api.js (CSP XSS fix)
- ✓ Refactored share.js to use ShareMenu component
- ✓ Created 3 new Hugo partials
- ✓ Updated compare.html to use partials
- ✓ Added CSS components to theme.css
- ✓ Removed all inline styles from templates and JS
- ✓ Completed CSP audit and added meta tag
- ✓ Improved Strong's tooltip accessibility (ARIA pattern)
- ✓ Added template documentation headers
- ✓ Phase 0 baseline inventory completed
- ✓ Architecture documentation created
